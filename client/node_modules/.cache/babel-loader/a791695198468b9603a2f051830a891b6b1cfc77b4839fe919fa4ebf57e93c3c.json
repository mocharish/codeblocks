{"ast":null,"code":"import React,{useState,useEffect}from'react';import io from'socket.io-client';import{useNavigate,useParams}from'react-router-dom';import{Prism as SyntaxHighlighter}from'react-syntax-highlighter';import{solarizedlight}from'react-syntax-highlighter/dist/esm/styles/prism';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const socket=io('http://localhost:3001');const CodeBlockPage=()=>{const{blockId}=useParams();const[role,setRole]=useState('Loading...');const[codeBlock,setCodeBlock]=useState('');const[title,setTitle]=useState('');const[studentCount,setStudentCount]=useState(0);const navigate=useNavigate();const[showSmiley,setShowSmiley]=useState(false);useEffect(()=>{if(!blockId){console.error('No blockId provided in route parameters');return;}const storedRole=localStorage.getItem('role');if(storedRole){setRole(storedRole);}// Join the code block room\nsocket.emit('joinCodeBlock',blockId);socket.on('role',assignedRole=>{setRole(assignedRole);localStorage.setItem('role',assignedRole);});socket.on('codeBlock',codeData=>{setCodeBlock(codeData.code);setTitle(codeData.title);});socket.on('studentCount',count=>{setStudentCount(count);});socket.on('mentorLeft',originalCode=>{console.log('Mentor has left. Resetting code and redirecting to lobby.');if(role==='student'){alert('The mentor has left. Redirecting to the lobby.');setCodeBlock(originalCode);// Reset the code\nnavigate('/');// Redirect to the lobby\n}});socket.on('solutionMatched',matched=>{if(matched){setShowSmiley(true);}});socket.on('reconnect',()=>{const storedRole=localStorage.getItem('role');if(blockId&&storedRole){socket.emit('joinCodeBlock',blockId);}});// Fetch code block on initial load\nconst fetchCodeBlock=async()=>{try{const response=await fetch(`http://localhost:3001/api/code-blocks/${blockId}`);if(!response.ok){throw new Error(`HTTP error! Status: ${response.status}`);}const codeData=await response.json();setCodeBlock(codeData.code);setTitle(codeData.title);}catch(error){console.error('Error fetching code block:',error);}};fetchCodeBlock();// Fetch code block on component mount\n// Cleanup event listeners on unmount\nreturn()=>{socket.off('role');socket.off('codeBlock');socket.off('studentCount');socket.off('mentorLeft');socket.off('solutionMatched');socket.off('reconnect');};},[blockId,role,navigate]);const handleCodeChange=e=>{const newCode=e.target.value;setCodeBlock(newCode);socket.emit('updateCode',newCode);};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:title||'Code Block'}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Role: \",role]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Number of Students: \",studentCount]}),/*#__PURE__*/_jsx(SyntaxHighlighter,{language:\"javascript\",style:solarizedlight,children:codeBlock}),role==='student'&&/*#__PURE__*/_jsx(\"textarea\",{value:codeBlock,onChange:handleCodeChange,style:{width:'100%',height:'300px',fontFamily:'monospace'}}),showSmiley&&/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'100px',textAlign:'center',marginTop:'20px'},children:\"\\uD83D\\uDE03\"})]});};export default CodeBlockPage;","map":{"version":3,"names":["React","useState","useEffect","io","useNavigate","useParams","Prism","SyntaxHighlighter","solarizedlight","jsx","_jsx","jsxs","_jsxs","socket","CodeBlockPage","blockId","role","setRole","codeBlock","setCodeBlock","title","setTitle","studentCount","setStudentCount","navigate","showSmiley","setShowSmiley","console","error","storedRole","localStorage","getItem","emit","on","assignedRole","setItem","codeData","code","count","originalCode","log","alert","matched","fetchCodeBlock","response","fetch","ok","Error","status","json","off","handleCodeChange","e","newCode","target","value","children","language","style","onChange","width","height","fontFamily","fontSize","textAlign","marginTop"],"sources":["C:/codeblocks/client/src/components/BlockPage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport io from 'socket.io-client';\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\nimport { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';\r\nimport { solarizedlight } from 'react-syntax-highlighter/dist/esm/styles/prism';\r\n\r\nconst socket = io('http://localhost:3001');\r\n\r\nconst CodeBlockPage = () => {\r\n  const { blockId } = useParams();\r\n  const [role, setRole] = useState('Loading...');\r\n  const [codeBlock, setCodeBlock] = useState('');\r\n  const [title, setTitle] = useState('');\r\n  const [studentCount, setStudentCount] = useState(0);\r\n  const navigate = useNavigate();\r\n  const [showSmiley, setShowSmiley] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!blockId) {\r\n      console.error('No blockId provided in route parameters');\r\n      return;\r\n    }\r\n\r\n    const storedRole = localStorage.getItem('role');\r\n    if (storedRole) {\r\n      setRole(storedRole);\r\n    }\r\n\r\n    // Join the code block room\r\n    socket.emit('joinCodeBlock', blockId);\r\n\r\n    socket.on('role', (assignedRole) => {\r\n      setRole(assignedRole);\r\n      localStorage.setItem('role', assignedRole);\r\n    });\r\n\r\n    socket.on('codeBlock', (codeData) => {\r\n      setCodeBlock(codeData.code);\r\n      setTitle(codeData.title);\r\n    });\r\n\r\n    socket.on('studentCount', (count) => {\r\n      setStudentCount(count);\r\n    });\r\n\r\n    socket.on('mentorLeft', (originalCode) => {\r\n      console.log('Mentor has left. Resetting code and redirecting to lobby.');\r\n\r\n      if (role === 'student') {\r\n        alert('The mentor has left. Redirecting to the lobby.');\r\n        setCodeBlock(originalCode);  // Reset the code\r\n        navigate('/');  // Redirect to the lobby\r\n      }\r\n    });\r\n\r\n    socket.on('solutionMatched', (matched) => {\r\n      if (matched) {\r\n        setShowSmiley(true);\r\n      }\r\n    });\r\n\r\n    socket.on('reconnect', () => {\r\n      const storedRole = localStorage.getItem('role');\r\n      if (blockId && storedRole) {\r\n        socket.emit('joinCodeBlock', blockId);\r\n      }\r\n    });\r\n\r\n    // Fetch code block on initial load\r\n    const fetchCodeBlock = async () => {\r\n      try {\r\n        const response = await fetch(`http://localhost:3001/api/code-blocks/${blockId}`);\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! Status: ${response.status}`);\r\n        }\r\n        const codeData = await response.json();\r\n        setCodeBlock(codeData.code);\r\n        setTitle(codeData.title);\r\n      } catch (error) {\r\n        console.error('Error fetching code block:', error);\r\n      }\r\n    };\r\n\r\n    fetchCodeBlock(); // Fetch code block on component mount\r\n\r\n    // Cleanup event listeners on unmount\r\n    return () => {\r\n      socket.off('role');\r\n      socket.off('codeBlock');\r\n      socket.off('studentCount');\r\n      socket.off('mentorLeft');\r\n      socket.off('solutionMatched');\r\n      socket.off('reconnect');\r\n    };\r\n  }, [blockId, role, navigate]);\r\n\r\n  const handleCodeChange = (e) => {\r\n    const newCode = e.target.value;\r\n    setCodeBlock(newCode);\r\n    socket.emit('updateCode', newCode);\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h1>{title || 'Code Block'}</h1>\r\n      <p>Role: {role}</p>\r\n      <p>Number of Students: {studentCount}</p>\r\n      <SyntaxHighlighter language=\"javascript\" style={solarizedlight}>\r\n        {codeBlock}\r\n      </SyntaxHighlighter>\r\n      {role === 'student' && (\r\n        <textarea\r\n          value={codeBlock}\r\n          onChange={handleCodeChange}\r\n          style={{ width: '100%', height: '300px', fontFamily: 'monospace' }}\r\n        />\r\n      )}\r\n      {showSmiley && (\r\n        <div style={{ fontSize: '100px', textAlign: 'center', marginTop: '20px' }}>\r\n          ðŸ˜ƒ\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CodeBlockPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}